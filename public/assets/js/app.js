function CategoriesService($http){this.getListOfCategoriesService=function(category){return $http({url:"http://doorsaround.com:3000/categoryList",method:"GET"}).success(function(data){console.log(data)}).error(function(data,status,headers,config){})}}function EventsService($http){this.getEvents=function(location,endpoint,category,currentPage,pageMaxSize){return console.log("http://localhost:8080/proxy/doors?endpoint="+endpoint+"path="+category+"&lat="+location.lat+"&lng="+location.long+"&from="+currentPage+"&size="+pageMaxSize),$http.get("http://localhost:8080/proxy/doors?endpoint="+endpoint+"&path="+category+"&lat="+location.lat+"&lng="+location.long+"&from="+currentPage+"&size="+pageMaxSize)}}var app=angular.module("doorsAround",["ui.router","ngGeolocation","infinite-scroll","ngMap","angularLazyImg"]);app.config(["$stateProvider","$urlRouterProvider","$locationProvider",function($stateProvider,$urlRouterProvider,$locationProvider,$state){$stateProvider.state("/",{url:"/",views:{main:{templateUrl:"pages/main.html",controller:"HomeController"}}}).state("category",{url:"/category/:categoryType",views:{main:{templateUrl:"pages/events/events.html",controller:"EventsController",params:null}}}).state("event",{url:"/event/:id",views:{main:{templateUrl:"pages/events/more.html",controller:"EventsInnerController"}}}).state("profile",{url:"/profile",views:{main:{templateUrl:"pages/profile/profile.html",controller:"ProfileController"},profile:{templateUrl:"pages/profile/edit.html",controller:"ProfileController"}},redirectTo:"profile.edit"}).state("profile.edit",{url:"/edit",views:{main:{templateUrl:"pages/profile/profile.html",controller:"ProfileController"},profile:{templateUrl:"pages/profile/edit.html",controller:"ProfileController"}}}).state("profile.events",{url:"/events",views:{main:{templateUrl:"pages/profile/profile.html",controller:"ProfileController"},profile:{templateUrl:"pages/profile/events.html",controller:"ProfileController"}}}).state("profile.createEvent",{url:"/createEvent",views:{main:{templateUrl:"pages/profile/profile.html",controller:"ProfileController"},profile:{templateUrl:"pages/profile/createEvent.html",controller:"ProfileController"}}}).state("profile.saved",{url:"/saved",views:{main:{templateUrl:"pages/profile/profile.html",controller:"ProfileController"},profile:{templateUrl:"pages/profile/saved.html",controller:"ProfileController"}}}),$locationProvider.html5Mode(!1).hashPrefix(""),$urlRouterProvider.otherwise("/")}]),app.service("CategoriesService",CategoriesService),CategoriesService.$inject=["$http"],app.service("EventsService",EventsService),EventsService.$inject=["$http"],app.directive("categoriespopup",function(){return{templateUrl:"../pages/category/popup.html"}}),app.directive("profile",function(){return{templateUrl:"../pages/profile/login.html"}}),app.directive("image",function($q){"use strict";var URL=window.URL||window.webkitURL,getResizeArea=function(){var resizeAreaId="fileupload-resize-area",resizeArea=document.getElementById(resizeAreaId);return resizeArea||(resizeArea=document.createElement("canvas"),resizeArea.id=resizeAreaId,resizeArea.style.visibility="hidden",document.body.appendChild(resizeArea)),resizeArea},resizeImage=function(origImage,options){var maxHeight=options.resizeMaxHeight||300,maxWidth=options.resizeMaxWidth||250,quality=options.resizeQuality||.7,type=options.resizeType||"image/jpg",canvas=getResizeArea(),height=origImage.height,width=origImage.width;width>height?width>maxWidth&&(height=Math.round(height*=maxWidth/width),width=maxWidth):height>maxHeight&&(width=Math.round(width*=maxHeight/height),height=maxHeight),canvas.width=width,canvas.height=height;var ctx=canvas.getContext("2d");return ctx.drawImage(origImage,0,0,width,height),canvas.toDataURL(type,quality)},createImage=function(url,callback){var image=new Image;image.onload=function(){callback(image)},image.src=url},fileToDataURL=function(file){var deferred=$q.defer(),reader=new FileReader;return reader.onload=function(e){deferred.resolve(e.target.result)},reader.readAsDataURL(file),deferred.promise};return{restrict:"A",rootScope:{},scope:{image:"=",resizeMaxHeight:"@?",resizeMaxWidth:"@?",resizeQuality:"@?",resizeType:"@?"},link:function(scope,element,attrs,ctrl){var doResizing=function(imageResult,callback){createImage(imageResult.url,function(image){var dataURL=resizeImage(image,scope);imageResult.resized={dataURL:dataURL,type:dataURL.match(/:(.+\/.+);/)[1]},callback(imageResult)})},applyScope=function(imageResult){scope.$apply(function(){attrs.multiple?scope.image.push(imageResult):scope.image=imageResult})};element.bind("change",function(evt){attrs.multiple&&(scope.image=[]);for(var files=evt.target.files,i=0;i<files.length;i++){var imageResult={file:files[i],url:URL.createObjectURL(files[i])};fileToDataURL(files[i]).then(function(dataURL){imageResult.dataURL=dataURL,localStorage.setItem("profilePicture",imageResult.dataURL)}),scope.resizeMaxHeight||scope.resizeMaxWidth?doResizing(imageResult,function(imageResult){applyScope(imageResult)}):applyScope(imageResult)}})}}}),app.controller("MainController",function($rootScope,$scope,$location,$window,$geolocation,$http,$interval,$state,EventsService){$header=$("header"),$body=$("body"),$profile=$(".profilePlace"),$slider=$(".slider__list"),$scope.sliderItem=["http://media.istockphoto.com/photos/business-people-at-cafe-picture-id518867576?s=2048x2048","https://xceed.me/bundles/site/img/home3.jpg","https://xceed.me/bundles/site/img/home2.jpg"],$scope.showPopup=!1,$scope.loginOpen=!1,$scope.userInformation={},$scope.isLogined=!1,$scope.userAvatar="",$scope.profileOpen=!1,$scope.mainPage=!0,$scope.currentSlide=0,$scope.categoriesList=[],$rootScope.categoryParams={},$scope.showLoginSection=!0,$scope.register={},$scope.login={},$scope.showCategories=function(){$scope.showPopup=!0,$body.css("overflow","hidden")},$scope.hideCategories=function(){$scope.showPopup=!1,$body.css("overflow","auto")},$scope.openLogin=function(){$scope.loginOpen=!0},$scope.closePrPopup=function(){$scope.loginOpen=!1,$scope.showLoginSection=!0},$scope.changeLoginView=function(value){$scope.showLoginSection=value},$rootScope.$on("$stateChangeSuccess",function(){$scope.showPopup=!1,document.body.scrollTop=0,document.documentElement.scrollTop=0,"/"===$location.path()?($header.removeClass("inner"),$scope.mainPage=!0):($header.addClass("inner"),$scope.mainPage=!1)}),$scope.backBtn=function(){$window.history.back()},$scope.checkUser=function(){0==$scope.isLogined&&$http.get("/profile/me").then(function(data){console.log(data.data),"true"==data.data.logedin&&($scope.userInformation=data.data.user.result._source,$scope.isLogined=!0,$http.get("https://graph.facebook.com/"+$scope.userInformation.userId+"?fields=picture.width(720).height(720)&access_token="+$scope.userInformation.access_token).then(function(data){data.data.picture.data.url?$scope.userAvatar=data.data.picture.data.url:$scope.userAvatar="https://blog.teachlr.com/wp-content/uploads/2016/06/hero-avatar.png"}))}).catch(function(response){console.log(response)})},$scope.profileToggle=function(e){1==$scope.isLogined&&(0==$scope.profileOpen?$scope.profileOpen=!0:$scope.profileOpen=!1)},$scope.checkUser(),$geolocation.getCurrentPosition().then(function(data){$rootScope.currentCoors={lat:data.coords.latitude,long:data.coords.longitude}}),$scope.getPlacesInfo=function(catInformation){$rootScope.categoryParams=catInformation},$scope.getCategories=function(){$http({url:"http://localhost:8080/proxy/doors?endpoint="+Conf.api.endpoint+"/&path=categoryList?",method:"GET"}).then(function(data){console.log(data),$scope.categoriesList=data.data})},$scope.getCategories(),$scope.signUp=function(){return $scope.register.profilePicture=localStorage.getItem("profilePicture"),$scope.registerData={email:$scope.register.email,firstName:$scope.register.firstName,lastName:$scope.register.lastName,password:$scope.register.password,profilePicture:$scope.register.profilePicture},localStorage.removeItem("profilePicture"),$scope.register.email&&$scope.register.firstName&&$scope.register.lastName&&$scope.register.password&&$scope.register.password==$scope.register.repeatPassword?void $http({method:"POST",data:$scope.registerData,url:"/user"}).then(function(response){console.log(response)},function(response){console.log(response)}):($scope.register.password!=$scope.register.repeatPassword&&$("#registerRepeatPassword").addClass("error"),$scope.register.email?$("#registerEmail").removeClass("error"):$("#registerEmail").addClass("error"),$scope.register.firstName?$("#registerFirstName").removeClass("error"):$("#registerFirstName").addClass("error"),$scope.register.lastName?$("#registerLastName").removeClass("error"):$("#registerLastName").addClass("error"),$scope.register.password?$("#registerPassword").removeClass("error"):$("#registerPassword").addClass("error"),!1)},$scope.signIn=function(){$http({method:"POST",data:$scope.login,url:"/user/checkUser"}).then(function(response){200==response.data.status?($scope.loginOpen=!1,$scope.isLogined=!0,$scope.userInformation.name=response.data.data.Item.firstName+" "+response.data.data.Item.lastName,$scope.userInformation.email=response.data.data.Item.email,response.data.data.Item.profilePicture?$scope.userAvatar=response.data.data.Item.profilePicture:$scope.userAvatar="https://blog.teachlr.com/wp-content/uploads/2016/06/hero-avatar.png"):$("#loginError").addClass("alert--visible").text(response.data.errorMessage)},function(response){console.log(response)})},$scope.slider=function(){$scope.currentSlide>=$scope.sliderItem.length-1?($scope.currentSlide=0,$(".slider__item").removeClass("active"),$(".slider__item").eq($scope.currentSlide).addClass("active")):($scope.currentSlide++,$(".slider__item").removeClass("active"),$(".slider__item").eq($scope.currentSlide).addClass("active"))},$scope.sliderItem&&$interval($scope.slider,5e3),$scope.createEventCheck=function(){$scope.isLogined?$state.go("profile.createEvent"):$scope.loginOpen=!0}}),app.controller("LoginController",function($scope,$window,$http){console.log("Login Page And Its Controller")}),app.controller("RegisterController",function($scope,$window,$http){console.log("Register Controller and Page")}),app.controller("HomeController",function($scope,$window){var $header=$("header");$(window).scroll(function(){console.log("aaa");var currentScroll=$(window).scrollTop();currentScroll>0?$header.addClass("scrolled"):$header.removeClass("scrolled")})}),app.controller("EventsController",function($rootScope,$scope,$stateParams,$http,$geolocation,$window,EventsService,$state,$location){$scope.category=$rootScope.categoryParams,$rootScope.listOfEvents=[],$scope.pageMaxSize=20,$rootScope.eventsTotalItems=0,$scope.eventsCurrentPage=0,$rootScope.selectedEvent,$scope.loadingMoreInformation=!1,$scope.sizeCorrector=function(total,page,size){var nextElements=(page+1)*size;return nextElements>total?total-page*size:size},$scope.getUserLocation=function(){void 0==$rootScope.coordinates?$geolocation.getCurrentPosition().then(function(data){$rootScope.coordinates={lat:data.coords.latitude,long:data.coords.longitude},$scope.getEventsByCategories($rootScope.coordinates)}):$scope.getEventsByCategories($rootScope.coordinates)},$scope.getEventsByCategories=function(location){EventsService.getEvents(location,$scope.category.endpoint,$scope.category.path,$scope.eventsCurrentPage,$scope.pageMaxSize).then(function(data){$rootScope.listOfEvents=data.data.response.hits.hits,$rootScope.eventsTotalItems=data.data.response.hits.total})},$scope.getUserLocation(),$scope.viewMore=function(id){$state.go("event")},$scope.selectEventInfo=function(eventInfo){$rootScope.selectedEvent=eventInfo},$scope.loadMore=function(){console.log("first load more"),$scope.eventsCurrentPage+=20,EventsService.getEvents($rootScope.coordinates,$scope.category.endpoint,$scope.category.path,$scope.eventsCurrentPage,$scope.pageMaxSize).then(function(data){console.log("final load more");for(var i=0;i<data.data.response.hits.hits.length;i++)$rootScope.listOfEvents.push(data.data.response.hits.hits[i]);$scope.loadingMoreInformation=!1})},$(window).scroll(function(){console.log("Testing scroll"),$(window).scrollTop()+$(window).height()>=$(document).height()-800&&0==$scope.loadingMoreInformation&&(console.log("First If"),console.log($rootScope.listOfEvents.length),console.log($rootScope.eventsTotalItems),$rootScope.listOfEvents.length<$rootScope.eventsTotalItems&&(console.log("aaaa"),$scope.loadingMoreInformation=!0,$scope.loadMore()))}),$scope.pagination=0}),app.controller("EventsInnerController",function($rootScope,$scope,$stateParams,$http,$geolocation,$window,$state,EventsService,NgMap){$scope.eventId=$stateParams.id,$scope.coordinates=[],$scope.currentCoordinates=[],$scope.review={placeId:$scope.eventId},$scope.reviewList=[],void 0!=$rootScope.selectedEvent?($scope.coordinates=[$rootScope.selectedEvent.location.lat,$rootScope.selectedEvent.location.lon],$scope.review.placeId=$rootScope.selectedEvent.id,$scope.currentCoordinates=[$rootScope.coordinates.lat,$rootScope.coordinates.long],$http.get("/proxy/review?placeId="+$scope.eventId+"&page=0&size=10").then(function(data){$scope.reviewList=data.data.response.hits.hits})):($http.get("http://localhost:8080/proxy/place?placeId="+$scope.eventId).then(function(data){$rootScope.selectedEvent=data.data,$scope.coordinates=[$rootScope.selectedEvent.location.lat,$rootScope.selectedEvent.location.lon]}),$http.get("/proxy/review?placeId="+$scope.eventId+"&page=0&size=10").then(function(data){$scope.reviewList=data.data.response.hits.hits,console.log($scope.reviewList)}),console.log($scope.reviewList)),$(".rating-star").mouseenter(function(){$(".rating-star-info").width(30*$(this).data("index"))}).mouseleave(function(){$(".rating-star-info").width(30*$scope.review.rating)}).click(function(){$scope.review.rating=$(this).data("index"),$(".rating-star-info").width(30*$scope.review.rating)}),$scope.addReview=function(){console.log("Posting review"),console.log("User Information",$scope.userInformation),$scope.isLogined===!0?($scope.review.userId=$scope.userInformation.userId,console.log("Is loginned"),$scope.review.rating&&$scope.review.reviewText&&""!=$scope.review.reviewText&&0!=$scope.review.rating&&$http({method:"POST",data:$scope.review,url:"/proxy/review"}).then(function(response){console.log("Finishing Posting Review"),console.log("RESPONSE",response);var userInfo={_source:{name:$scope.userInformation.name,picture:$scope.userInformation.picture}};$scope.review.user=userInfo;var newReview={_source:$scope.review};$scope.reviewList.unshift(newReview),console.log(response)},function(response){console.log(response)})):console.log("User Needs Sign In")}}),app.controller("CategoryController",function($scope,$window){}),app.controller("ProfileController",function($rootScope,$scope,$window,$geolocation){$scope.mapLoading=!0,$scope.eventRegister={name:"",description:"",email:"",location:{lat:"",lon:""},date:{startDate:new Date,endDate:new Date},coverPicture1:"",coverPicture2:"",coverPicture3:""},$rootScope.currentCoors?($scope.coordinates=[$rootScope.currentCoors.lat,$rootScope.currentCoors.long],$scope.mapLoading=!1,$scope.eventRegister.location.lat=$rootScope.currentCoors.lat,$scope.eventRegister.location.lon=$rootScope.currentCoors.long):$geolocation.getCurrentPosition().then(function(data){$rootScope.currentCoors={lat:data.coords.latitude,long:data.coords.longitude},$scope.coordinates=[$rootScope.currentCoors.lat,$rootScope.currentCoors.long],$scope.eventRegister.location.lat=$rootScope.currentCoors.lat,$scope.eventRegister.location.lon=$rootScope.currentCoors.long,$scope.mapLoading=!1}),$scope.createEvent=function(){console.log($scope.eventRegister)}});